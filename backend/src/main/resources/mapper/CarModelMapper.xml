<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.carsale.mapper.CarModelMapper">

    <resultMap id="BaseResultMap" type="com.carsale.entity.CarModel">
        <id column="model_id" property="modelId" jdbcType="INTEGER"/>
        <result column="manufacturer_id" property="manufacturerId" jdbcType="INTEGER"/>
        <result column="model_name" property="modelName" jdbcType="VARCHAR"/>
        <result column="year" property="year" jdbcType="INTEGER"/>
        <result column="engine_type" property="engineType" jdbcType="VARCHAR"/>
        <result column="transmission" property="transmission" jdbcType="VARCHAR"/>
        <result column="fuel_type" property="fuelType" jdbcType="VARCHAR"/>
        <result column="guide_price" property="guidePrice" jdbcType="DECIMAL"/>
        <result column="features" property="features" jdbcType="VARCHAR"/>
        <result column="created_at" property="createdAt" jdbcType="TIMESTAMP"/>
        <result column="updated_at" property="updatedAt" jdbcType="TIMESTAMP"/>
    </resultMap>

    <resultMap id="CarModelWithManufacturerResultMap" type="com.carsale.entity.CarModel" extends="BaseResultMap">
        <association property="manufacturer" javaType="com.carsale.entity.Manufacturer">
            <id column="m_id" property="manufacturerId"/>
            <result column="manufacturer_name" property="manufacturerName"/>
            <result column="contact_person" property="contactPerson"/>
            <result column="contact_phone" property="contactPhone"/>
        </association>
    </resultMap>

    <select id="selectByManufacturerId" resultMap="BaseResultMap">
        SELECT * FROM car_model
        WHERE manufacturer_id = #{manufacturerId}
        ORDER BY model_name ASC
    </select>

    <select id="selectPageWithManufacturer" resultMap="CarModelWithManufacturerResultMap">
        SELECT
        cm.*,
        m.manufacturer_id as m_id,
        m.manufacturer_name,
        m.contact_person,
        m.contact_phone
        FROM car_model cm
        LEFT JOIN manufacturer m ON cm.manufacturer_id = m.manufacturer_id
        WHERE 1=1
        <if test="modelName != null and modelName != ''">
            AND cm.model_name LIKE CONCAT('%', #{modelName}, '%')
        </if>
        <if test="year != null">
            AND cm.year = #{year}
        </if>
        ORDER BY cm.created_at DESC
    </select>

</mapper>