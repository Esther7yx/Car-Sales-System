<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.carsale.mapper.CarModelMapper">

    <!-- 基础结果集映射 -->
    <resultMap id="BaseResultMap" type="com.carsale.entity.CarModel">
        <id column="model_id" property="modelId" jdbcType="INTEGER"/>
        <result column="manufacturer_id" property="manufacturerId" jdbcType="INTEGER"/>
        <result column="model_name" property="modelName" jdbcType="VARCHAR"/>
        <result column="model_code" property="modelCode" jdbcType="VARCHAR"/>
        <result column="year" property="year" jdbcType="INTEGER"/>
        <result column="description" property="description" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="VARCHAR"/>
        <result column="created_at" property="createdAt" jdbcType="TIMESTAMP"/>
        <result column="updated_at" property="updatedAt" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- 包含厂商信息的结果集映射 -->
    <resultMap id="CarModelWithManufacturerResultMap" type="com.carsale.entity.CarModel" extends="BaseResultMap">
        <!-- 厂商信息 -->
        <result column="manufacturer_name" property="manufacturerName" jdbcType="VARCHAR"/>
        <result column="manufacturer_code" property="manufacturerCode" jdbcType="VARCHAR"/>
        <result column="cooperation_status" property="cooperationStatus" jdbcType="VARCHAR"/>
    </resultMap>

    <!-- 根据厂商ID查询车型列表 -->
    <select id="selectByManufacturerId" resultMap="BaseResultMap">
        SELECT * FROM car_model
        WHERE manufacturer_id = #{manufacturerId}
        AND status = 'active'
        ORDER BY model_name ASC
    </select>

    <!-- 分页查询车型信息，包含厂商关联 -->
    <select id="selectPageWithManufacturer" resultMap="CarModelWithManufacturerResultMap">
        SELECT 
            cm.*, 
            m.manufacturer_name, 
            m.manufacturer_code, 
            m.cooperation_status
        FROM car_model cm
        LEFT JOIN manufacturer m ON cm.manufacturer_id = m.manufacturer_id
        WHERE 1=1
        <if test="modelName != null and modelName != ''">
            AND cm.model_name LIKE CONCAT('%', #{modelName}, '%')
        </if>
        <if test="year != null">
            AND cm.year = #{year}
        </if>
        ORDER BY cm.created_at DESC
    </select>

</mapper>